@inherits Chloroplast.Core.Rendering.ChloroplastTemplateBase<Chloroplast.Core.Rendering.RenderedContent>
@using Chloroplast.Core
<div class="container" style="margin-left:0; max-width:100%;">
    <div class="row">
        @{
            var baseMenu = "source/menu.md";
            var localizedMenu = CurrentLocale != SiteConfig.DefaultLocale ? $"source/menu.{CurrentLocale}.md" : baseMenu;
            // Try localized first; PartialAsync will throw if missing, so check file existence
            var rootPath = SiteConfig.Instance["root"];
            var localizedMenuFull = System.IO.Path.Combine(rootPath, localizedMenu.Replace("/", System.IO.Path.DirectorySeparatorChar.ToString()));
            var menuPathToUse = System.IO.File.Exists(localizedMenuFull) ? localizedMenu : baseMenu;
        }
        @await PartialAsync(menuPathToUse)
        <div class="main-content">
            <h2>@Model.GetMeta("title")</h2>
            @if (@Model.HasMeta("subtitle"))
            {
                <h3>@Model.GetMeta("subtitle")</h3>
            }
            @* Centralized translation/fallback + machine translation notices *@
            @{
                var baseName = "TranslationWarning";
                var localizedName = baseName + "." + CurrentLocale;
                MiniRazor.RawString _tw;
                if (CurrentLocale != SiteConfig.DefaultLocale)
                {
                    try { _tw = await PartialAsync(localizedName, Model); }
                    catch { _tw = await PartialAsync(baseName, Model); }
                }
                else
                {
                    _tw = await PartialAsync(baseName, Model);
                }
                @_tw;
            }

            @Raw(Model.Body)
        </div>
    </div>
</div>